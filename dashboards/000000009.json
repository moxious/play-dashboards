{"meta":{"type":"db","canSave":false,"canEdit":true,"canAdmin":false,"canStar":false,"canDelete":false,"slug":"ultimate-graphite-query-guide","url":"/d/000000009/ultimate-graphite-query-guide","expires":"0001-01-01T00:00:00Z","created":"2021-02-09T09:05:21Z","updated":"2022-07-18T20:46:52Z","updatedBy":"matt.abrams@grafana.com","createdBy":"daniel@grafana.com","version":3,"hasAcl":false,"isFolder":false,"folderId":457,"folderUid":"bU3muVPmz","folderTitle":"Data source: Graphite","folderUrl":"/dashboards/f/bU3muVPmz/data-source-graphite","provisioned":false,"provisionedExternalId":"","annotationsPermissions":{"dashboard":{"canAdd":true,"canEdit":true,"canDelete":true},"organization":{"canAdd":false,"canEdit":false,"canDelete":false}},"hasPublicDashboard":false,"publicDashboardAccessToken":"","publicDashboardUid":"","publicDashboardEnabled":false},"dashboard":{"annotations":{"enable":false,"list":[{"builtIn":1,"datasource":{"type":"datasource","uid":"grafana"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":990,"links":[],"liveNow":false,"panels":[{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"editable":true,"error":false,"gridPos":{"h":4,"w":12,"x":0,"y":0},"height":"","id":18,"links":[],"options":{"content":"#### Wildcards\n\nAll graphite queries target one or more series. A series has a unique full name. To target more than one series within a single metric expression you can use a wildcard like in the example to the left. \n\n- Query: `apps.backend.*.counters.requests.count`","mode":"markdown"},"pluginVersion":"9.0.3","style":{},"targets":[{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"refId":"A"}],"transparent":true,"type":"text"},{"aliasColors":{"apps.backend.backend_02.counters.requests.count":"#7EB26D","apps.backend.backend_03.counters.requests.count":"#9AC48A","apps.backend.backend_04.counters.requests.count":"#B7DBAB","moving average (1)":"#EAB839","moving average (4)":"#EAB839"},"annotate":{"enable":false},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"graphite","uid":"000000001"},"editable":true,"error":false,"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":4,"w":12,"x":12,"y":0},"hiddenSeries":false,"id":11,"legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"maxPerRow":4,"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.0.3","pointradius":5,"points":false,"renderer":"flot","repeat":"Servers","resolution":100,"scale":1,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"datasource":{"uid":"graphite"},"refId":"A","target":"apps.backend.*.counters.requests.count","textEditor":true}],"thresholds":[],"timeRegions":[],"tooltip":{"query_as_alias":true,"shared":false,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"$$hashKey":"object:354","format":"short","logBase":1,"show":true},{"$$hashKey":"object:355","format":"short","logBase":1,"show":true}],"yaxis":{"align":false},"zerofill":true},{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"editable":true,"error":false,"gridPos":{"h":4,"w":12,"x":0,"y":4},"height":"","id":20,"links":[],"options":{"content":"#### Glob expression\n\nInstead of using a wildcard you can use the syntax: {val1,val2} in any metric node (or part of a node) to get a sub set of series. \n\n- Query: `apps.backend.{backend_01,backend_04}.counters.requests.count`","mode":"markdown"},"pluginVersion":"9.0.3","style":{},"targets":[{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"refId":"A"}],"transparent":true,"type":"text"},{"aliasColors":{"apps.backend.backend_01.counters.requests.count":"#EF843C","apps.backend.backend_04.counters.requests.count":"#E24D42","moving average (1)":"#EAB839","moving average (4)":"#EAB839"},"annotate":{"enable":false},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"graphite","uid":"000000001"},"editable":true,"error":false,"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":4,"w":12,"x":12,"y":4},"hiddenSeries":false,"id":19,"legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"maxPerRow":4,"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.0.3","pointradius":5,"points":false,"renderer":"flot","repeat":"Servers","resolution":100,"scale":1,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"datasource":{"uid":"graphite"},"refId":"A","target":"apps.backend.{backend_01,backend_04}.counters.requests.count","textEditor":true}],"thresholds":[],"timeRegions":[],"tooltip":{"query_as_alias":true,"shared":false,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"$$hashKey":"object:267","format":"short","logBase":1,"show":true},{"$$hashKey":"object:268","format":"short","logBase":1,"show":true}],"yaxis":{"align":false},"zerofill":true},{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"editable":true,"error":false,"gridPos":{"h":4,"w":12,"x":0,"y":8},"height":"","id":21,"links":[],"options":{"content":"#### Glob expression Part 2\n\nGlob expressions also supports character ranges \n\n- Query: `apps.backend.backend_0[2-3].counters.requests.count`","mode":"markdown"},"pluginVersion":"9.0.3","style":{},"targets":[{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"refId":"A"}],"transparent":true,"type":"text"},{"aliasColors":{"moving average (1)":"#EAB839","moving average (4)":"#EAB839"},"annotate":{"enable":false},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"graphite","uid":"000000001"},"editable":true,"error":false,"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":4,"w":12,"x":12,"y":8},"hiddenSeries":false,"id":22,"legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"maxPerRow":4,"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.0.3","pointradius":5,"points":false,"renderer":"flot","repeat":"Servers","resolution":100,"scale":1,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"datasource":{"uid":"graphite"},"refId":"A","target":"apps.backend.backend_0[2-3].counters.requests.count","textEditor":true}],"thresholds":[],"timeRegions":[],"tooltip":{"query_as_alias":true,"shared":false,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"$$hashKey":"object:441","format":"short","logBase":1,"show":true},{"$$hashKey":"object:442","format":"short","logBase":1,"show":true}],"yaxis":{"align":false},"zerofill":true},{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"editable":true,"error":false,"gridPos":{"h":4,"w":12,"x":0,"y":12},"height":"","id":24,"links":[],"options":{"content":"#### Aliasing (naming series)\n\nThe simplest way to change the series name is using the `alias` function. But if you have a query that\nreturns multiple series you need to use `aliasByNode` instead.\n\n- Query: `apps.backend.*.counters.requests.count ` -\u003e ` aliasByNode(2)`","mode":"markdown"},"pluginVersion":"9.0.3","style":{},"targets":[{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"refId":"A"}],"transparent":true,"type":"text"},{"aliasColors":{"moving average (1)":"#EAB839","moving average (4)":"#EAB839"},"annotate":{"enable":false},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"graphite","uid":"000000001"},"editable":true,"error":false,"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":4,"w":12,"x":12,"y":12},"hiddenSeries":false,"id":23,"legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"maxPerRow":4,"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.0.3","pointradius":5,"points":false,"renderer":"flot","repeat":"Servers","resolution":100,"scale":1,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"datasource":{"uid":"graphite"},"refId":"A","target":"aliasByNode(apps.backend.*.counters.requests.count, 2)","textEditor":true}],"thresholds":[],"timeRegions":[],"tooltip":{"query_as_alias":true,"shared":false,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"$$hashKey":"object:528","format":"short","logBase":1,"show":true},{"$$hashKey":"object:529","format":"short","logBase":1,"show":true}],"yaxis":{"align":false},"zerofill":true},{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"editable":true,"error":false,"gridPos":{"h":5,"w":12,"x":0,"y":16},"height":"","id":26,"links":[],"options":{"content":"#### Metric resolution and rollup effects\n\nGraphite will apply roll ups as metrics come in depending on how your graphite storage-schema.conf is defined. Depending on what time range you have \ngraphite will pick the right roll up bucket. If your metrics are written every 10 second (highest resolution) and stored for 1 day, then \nrolled up into 1min buckets and stored for 7 days, (Example: `10s:1d,1m:7d,10m:1y`) \n\nThen if the query time range exceeds one day you will get the rolled up data. You can see the effect of this on the graph \nto the right where the SAME metric is graphed, one is timeshifted back 2 days. As you can see the older series has much \nhigher values. This is due to the fact that this series is a counter (ends with `.count`) and will be rolled up using `sum` function. \n\nWhen graphing counters it is important to understand that the values can change depending on time range. \n\n-  `apps.backend.backend_01.counters.requests.count ` -\u003e ` aliasByNode(2)` -\u003e `alias(current)`\n-  `apps.backend.backend_01.counters.requests.count ` -\u003e `timeShift(2d)` -\u003e ` aliasByNode(2)`  -\u003e  `alias(2 days ago)`\n\n\nIn the second graph you see no difference in scale between the two series. This is due to the fact that we have applied the function scaleToSeconds to both queries. This function \nwill scale the counter so it represents value per second which will negate the roll up effect as Graphite is smart enough to apply different scaling depending on what roll up bucket it fetched data from.","mode":"markdown"},"pluginVersion":"9.0.3","style":{},"targets":[{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"refId":"A"}],"transparent":true,"type":"text"},{"aliasColors":{"moving average (1)":"#EAB839","moving average (4)":"#EAB839"},"annotate":{"enable":false},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"graphite","uid":"000000001"},"editable":true,"error":false,"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":5,"w":12,"x":12,"y":16},"height":"","hiddenSeries":false,"id":25,"legend":{"alignAsTable":true,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"maxPerRow":4,"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.0.3","pointradius":5,"points":false,"renderer":"flot","repeat":"Servers","resolution":100,"scale":1,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"datasource":{"uid":"graphite"},"refCount":0,"refId":"A","target":"alias(apps.backend.backend_01.counters.requests.count, 'current')","textEditor":true},{"datasource":{"uid":"graphite"},"refCount":0,"refId":"B","target":"alias(timeShift(apps.backend.backend_01.counters.requests.count, '2d'), '2 days ago')","textEditor":true}],"thresholds":[],"timeRegions":[],"title":"roll up effects showing","tooltip":{"query_as_alias":true,"shared":false,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"$$hashKey":"object:615","format":"short","logBase":1,"show":true},{"$$hashKey":"object:616","format":"short","logBase":1,"show":true}],"yaxis":{"align":false},"zerofill":true},{"datasource":{"type":"graphite","uid":"000000001"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":20,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"normal"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"short"},"overrides":[{"matcher":{"id":"byName","options":"moving average (1)"},"properties":[{"id":"color","value":{"fixedColor":"#EAB839","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"moving average (4)"},"properties":[{"id":"color","value":{"fixedColor":"#EAB839","mode":"fixed"}}]}]},"gridPos":{"h":5,"w":12,"x":0,"y":21},"id":27,"links":[],"options":{"legend":{"calcs":[],"displayMode":"table","placement":"right"},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"9.0.3","repeat":"Servers","targets":[{"datasource":{"uid":"graphite"},"refCount":0,"refId":"A","target":"alias(scaleToSeconds(apps.backend.backend_01.counters.requests.count, 1), 'current')","textEditor":true},{"datasource":{"uid":"graphite"},"refCount":0,"refId":"B","target":"alias(scaleToSeconds(timeShift(apps.backend.backend_01.counters.requests.count, '2d'), 1), '2 days ago')","textEditor":true}],"title":"With scaleToSeconds","type":"timeseries"},{"aliasColors":{"moving average (1)":"#EAB839","moving average (4)":"#EAB839"},"annotate":{"enable":false},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"graphite","uid":"000000001"},"editable":true,"error":false,"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":4,"w":6,"x":12,"y":21},"height":"150px","hiddenSeries":false,"id":29,"legend":{"alignAsTable":false,"avg":true,"current":false,"max":true,"min":false,"rightSide":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"maxPerRow":4,"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.0.3","pointradius":5,"points":false,"renderer":"flot","repeat":"Servers","resolution":100,"scale":1,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"datasource":{"uid":"graphite"},"refId":"A","target":"aliasByNode(apps.backend.backend_01.counters.requests.count, 2)","textEditor":true}],"thresholds":[],"timeRegions":[],"title":"Default consolidation (avg)","tooltip":{"query_as_alias":true,"shared":false,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"$$hashKey":"object:702","format":"short","logBase":1,"show":true},{"$$hashKey":"object:703","format":"short","logBase":1,"show":true}],"yaxis":{"align":false},"zerofill":true},{"aliasColors":{"moving average (1)":"#EAB839","moving average (4)":"#EAB839"},"annotate":{"enable":false},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"graphite","uid":"000000001"},"editable":true,"error":false,"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":4,"w":6,"x":18,"y":21},"height":"150px","hiddenSeries":false,"id":30,"legend":{"alignAsTable":false,"avg":true,"current":false,"max":true,"min":false,"rightSide":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"maxPerRow":4,"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.0.3","pointradius":5,"points":false,"renderer":"flot","repeat":"Servers","resolution":100,"scale":1,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"datasource":{"uid":"graphite"},"refId":"A","target":"aliasByNode(consolidateBy(apps.backend.backend_01.counters.requests.count, 'sum'), 2)","textEditor":true}],"thresholds":[],"timeRegions":[],"title":"sum consolidation","tooltip":{"query_as_alias":true,"shared":false,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"$$hashKey":"object:787","format":"short","logBase":1,"show":true},{"$$hashKey":"object:788","format":"short","logBase":1,"show":true}],"yaxis":{"align":false},"zerofill":true},{"aliasColors":{"moving average (1)":"#EAB839","moving average (4)":"#EAB839"},"annotate":{"enable":false},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"graphite","uid":"000000001"},"editable":true,"error":false,"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":4,"w":6,"x":12,"y":25},"height":"150px","hiddenSeries":false,"id":31,"legend":{"alignAsTable":false,"avg":true,"current":false,"max":true,"min":false,"rightSide":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"maxPerRow":4,"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.0.3","pointradius":5,"points":false,"renderer":"flot","repeat":"Servers","resolution":100,"scale":1,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"datasource":{"uid":"graphite"},"refId":"A","target":"aliasByNode(consolidateBy(apps.backend.backend_01.counters.requests.count, 'max'), 2)","textEditor":true}],"thresholds":[],"timeRegions":[],"title":"Max consolidation","tooltip":{"query_as_alias":true,"shared":false,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"$$hashKey":"object:872","format":"short","logBase":1,"show":true},{"$$hashKey":"object:873","format":"short","logBase":1,"show":true}],"yaxis":{"align":false},"zerofill":true},{"aliasColors":{"moving average (1)":"#EAB839","moving average (4)":"#EAB839"},"annotate":{"enable":false},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"graphite","uid":"000000001"},"editable":true,"error":false,"fill":2,"fillGradient":0,"grid":{},"gridPos":{"h":4,"w":6,"x":18,"y":25},"height":"150px","hiddenSeries":false,"id":32,"legend":{"alignAsTable":false,"avg":true,"current":false,"max":true,"min":false,"rightSide":false,"show":true,"total":true,"values":true},"lines":true,"linewidth":1,"links":[],"maxPerRow":4,"nullPointMode":"connected","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.0.3","pointradius":5,"points":false,"renderer":"flot","repeat":"Servers","resolution":100,"scale":1,"seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"datasource":{"uid":"graphite"},"refId":"A","target":"aliasByNode(consolidateBy(apps.backend.backend_01.counters.requests.count, 'min'), 2)","textEditor":true}],"thresholds":[],"timeRegions":[],"title":"Min consolidation","tooltip":{"query_as_alias":true,"shared":false,"sort":0,"value_type":"cumulative"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"$$hashKey":"object:957","format":"short","logBase":1,"show":true},{"$$hashKey":"object:958","format":"short","logBase":1,"show":true}],"yaxis":{"align":false},"zerofill":true},{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"editable":true,"error":false,"gridPos":{"h":7,"w":12,"x":0,"y":26},"height":"","id":28,"links":[],"options":{"content":"#### Point consolidation \u0026 maxDataPoints\n\nThis point is very important to understand. Grafana will request x amounts of data points from Graphite (via the `maxDataPoints`) parameter, this is set to \nwidth of the graph in pixels. \n\nThis has very *significant* effects on the values returned. Graphite will consolidate the real amount of values down to the request amount. This will\nbe done by default using `average`. You can change this consolidation function using the `consolidateBy` function. \n\nThis has very important effects on the legend values which are calculated by Grafana *AFTER* Graphite point consolidation. So you\ncannot show `avg`, `max`, `min`, `total` and have them all be accurate at the same time!","mode":"markdown"},"pluginVersion":"9.0.3","style":{},"targets":[{"datasource":{"type":"testdata","uid":"9cY0WtPMz"},"refId":"A"}],"transparent":true,"type":"text"}],"refresh":false,"schemaVersion":36,"style":"dark","tags":["graphite"],"templating":{"list":[]},"time":{"from":"now-6h","to":"now"},"timepicker":{"collapse":false,"enable":true,"notice":false,"now":true,"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"status":"Stable","time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"],"type":"timepicker"},"timezone":"browser","title":"Ultimate Graphite Query Guide","uid":"000000009","version":3,"weekStart":""}}