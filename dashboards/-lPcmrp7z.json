{"meta":{"type":"db","canSave":false,"canEdit":true,"canAdmin":false,"canStar":false,"canDelete":false,"slug":"loki-nginx-service-mesh-pattern-version","url":"/d/-lPcmrp7z/loki-nginx-service-mesh-pattern-version","expires":"0001-01-01T00:00:00Z","created":"2021-12-06T16:06:59Z","updated":"2022-11-25T15:11:10Z","updatedBy":"wardbekker1","createdBy":"wardbekker1","version":38,"hasAcl":false,"isFolder":false,"folderId":1199,"folderUid":"EVO2J4Hnz","folderTitle":"Data source: Loki","folderUrl":"/dashboards/f/EVO2J4Hnz/data-source-loki","provisioned":false,"provisionedExternalId":"","annotationsPermissions":{"dashboard":{"canAdd":true,"canEdit":true,"canDelete":true},"organization":{"canAdd":false,"canEdit":false,"canDelete":false}},"hasPublicDashboard":false,"publicDashboardAccessToken":"","publicDashboardUid":"","publicDashboardEnabled":false},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"datasource","uid":"grafana"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"description":"Loki v2+ showcase using regular NGINX access logs.","editable":true,"fiscalYearStartMonth":0,"gnetId":12559,"graphTooltip":0,"id":1291,"links":[{"asDropdown":false,"icon":"external link","includeVars":false,"keepTime":false,"tags":[],"targetBlank":false,"title":"Learn more at Grafana.com","tooltip":"Learn more at Grafana.com","type":"link","url":"https://grafana.com?pg=play\u0026plcmt=lokinginx"},{"asDropdown":false,"icon":"external link","includeVars":false,"keepTime":false,"tags":[],"targetBlank":false,"title":"Grafana Cloud now free with 50gb logs, 10K metric series","tooltip":"Grafana Cloud now free with 50gb loki logs, 10K metric series","type":"link","url":"https://grafana.com/signup/cloud/connect-account?pg=play\u0026plcmt=lokinginx"}],"liveNow":false,"panels":[{"collapsed":false,"datasource":{"uid":"$datasource"},"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":24,"panels":[],"targets":[{"datasource":{"uid":"$datasource"},"refId":"A"}],"title":"KPI's","type":"row"},{"datasource":{"type":"loki","uid":"NX9d1VH7k"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"purple","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":5,"w":5,"x":0,"y":1},"hideTimeOverride":false,"id":4,"maxDataPoints":300,"options":{"colorMode":"background","graphMode":"area","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["sum"],"fields":"","values":false},"text":{},"textMode":"value_and_name"},"pluginVersion":"9.2.5","targets":[{"datasource":{"type":"loki","uid":"NX9d1VH7k"},"expr":"sum by(host) (count_over_time({}[$__interval]))  ","legendFormat":"Total requests","refId":"A"}],"timeFrom":"24h","transformations":[],"type":"stat"},{"datasource":{"type":"loki","uid":"NX9d1VH7k"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"percentage","steps":[{"color":"rgba(110, 157, 228, 0.76)","value":null},{"color":"rgba(73, 124, 202, 1)","value":20}]},"unit":"short"},"overrides":[]},"gridPos":{"h":9,"w":7,"x":5,"y":1},"id":5,"maxDataPoints":100,"options":{"colorMode":"background","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["sum"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"9.2.5","targets":[{"datasource":{"type":"loki","uid":"NX9d1VH7k"},"expr":"sum by (status) (count_over_time({} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003cresponse_time\u003e` | status != \"\" and status != `\"-\"` | __error__=\"\" [$__interval]))","instant":false,"legendFormat":"Status {{status}}","range":true,"refId":"A"}],"title":"Requests per HTTP status code","transformations":[],"type":"stat"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"semi-dark-orange","value":null}]},"unit":"decbytes"},"overrides":[]},"gridPos":{"h":5,"w":3,"x":12,"y":1},"id":30,"maxDataPoints":1,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["sum"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"bytes_over_time({}[$__interval])","instant":true,"legendFormat":"$label_value","range":false,"refId":"A"}],"title":"NGINX logs in bytes","type":"stat"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"purple","value":null}]},"unit":"decbytes"},"overrides":[]},"gridPos":{"h":5,"w":3,"x":15,"y":1},"id":8,"maxDataPoints":1,"options":{"colorMode":"background","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["sum"],"fields":"","values":false},"text":{},"textMode":"value"},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"sum by (host) (sum_over_time({} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003cresponse_time\u003e` | unwrap body_bytes_sent |  __error__=\"\" [$__interval]))","instant":true,"legendFormat":"Bytes sent","range":false,"refId":"A"}],"title":"Total Bytes Sent","transformations":[],"type":"stat"},{"datasource":{"type":"graphite","uid":"000000001"},"description":"","gridPos":{"h":5,"w":6,"x":18,"y":1},"id":34,"options":{"code":{"language":"plaintext","showLineNumbers":false,"showMiniMap":false},"content":"üìä Dashboard created by Ward Bekker (hope you like it!)\n\nüê¶ Follow me on [Twitter](https://twitter.com/wardbekker) \u0026 [LinkedIn](https://www.linkedin.com/in/wardbekker/) for  Grafana Loki updates \n\nüé• Check out my [Grafana Loki video's](https://www.youtube.com/playlist?list=PLDGkOdUX1UjqEzcxQrbROMy8DN7MZv_h4) on Youtube","mode":"markdown"},"pluginVersion":"9.2.5","targets":[{"datasource":{"type":"graphite","uid":"000000001"},"refId":"A"}],"transparent":true,"type":"text"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"purple","value":null}]}},"overrides":[{"matcher":{"id":"byFrameRefID","options":"A"},"properties":[{"id":"displayName","value":"Realtime visitors"}]}]},"gridPos":{"h":4,"w":5,"x":0,"y":6},"id":22,"interval":"5m","options":{"colorMode":"background","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["mean"],"fields":"","values":false},"text":{},"textMode":"value_and_name"},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"count(sum by (remote_addr) (count_over_time({} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003cresponse_time\u003e` |  __error__=\"\" [$__interval])))","instant":true,"legendFormat":"","range":false,"refId":"A"}],"timeFrom":"5m","transformations":[],"type":"stat"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"semi-dark-orange","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":3,"x":12,"y":6},"id":31,"maxDataPoints":1,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["sum"],"fields":"","values":false},"text":{},"textMode":"auto"},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"count_over_time({}[$__interval])","instant":true,"range":false,"refId":"A"}],"title":"# NGINX log lines","type":"stat"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"decimals":1,"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"purple","value":null},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":4,"w":3,"x":15,"y":6},"hideTimeOverride":true,"id":19,"links":[],"maxDataPoints":1,"options":{"colorMode":"background","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["max"],"fields":"","values":false},"text":{},"textMode":"value"},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"sum(count_over_time({} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003cresponse_time\u003e` | status \u003e= 500 |__error__=\"\"[$__interval])) / (sum(count_over_time({} [$__interval]))/ 100)","instant":false,"legendFormat":"","range":true,"refId":"A"}],"timeFrom":"1h","title":"% of 5xx requests ","type":"stat"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"purple","value":null}]},"unit":"percent"},"overrides":[{"matcher":{"id":"byFrameRefID","options":"A"},"properties":[{"id":"displayName","value":"ü§ñ Googlebot"}]}]},"gridPos":{"h":4,"w":6,"x":18,"y":6},"hideTimeOverride":true,"id":18,"interval":"5m","links":[],"options":{"colorMode":"background","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["last"],"fields":"","values":false},"text":{},"textMode":"value_and_name"},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"sum(count_over_time(({} |= \"Googlebot\")[$__interval])) / (sum(count_over_time(({} != \"Googlebot\")[$__interval])) / 100)","instant":false,"legendFormat":"","range":true,"refId":"A"}],"timeFrom":"1h","title":"% of requests by Googlebot","type":"stat"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"#96D98D","value":null},{"color":"#73BF69","value":5},{"color":"#56A64B","value":10}]}},"overrides":[]},"gridPos":{"h":11,"w":21,"x":0,"y":10},"id":14,"options":{"basemap":{"config":{"server":"streets"},"name":"Layer 0","type":"esri-xyz"},"controls":{"mouseWheelZoom":false,"showAttribution":true,"showDebug":false,"showMeasure":false,"showScale":false,"showZoom":true},"layers":[{"config":{"color":{"fixed":"semi-dark-blue"},"fillOpacity":0.3,"shape":"circle","showLegend":true,"size":{"field":"Total","fixed":5,"max":50,"min":10},"style":{"color":{"fixed":"light-blue"},"size":{"field":"Total","fixed":5,"max":50,"min":10},"text":{"field":"Field","mode":"fixed"}}},"location":{"lookup":"Field","mode":"lookup"},"name":"Layer 1","type":"markers"}],"tooltip":{"mode":"details"},"view":{"allLayers":true,"id":"zero","lat":0,"lon":0,"zoom":2}},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"sum by (geoip_country_code) (count_over_time({} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003cresponse_time\u003e \u003cgeoip_country_code\u003e` | __error__=\"\" [$__interval]))","instant":false,"legendFormat":"{{geoip_country_code}}","range":true,"refId":"A"}],"title":"Requests per Country","transformations":[{"id":"reduce","options":{"reducers":["sum"]}}],"type":"geomap"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"continuous-BlPu"},"custom":{"align":"center","displayMode":"auto","filterable":false,"inspect":false},"mappings":[{"options":{"CN":{"color":"transparent","index":4,"text":"üá®üá≥CN"},"DE":{"color":"transparent","index":2,"text":"üá©üá™DE"},"FR":{"color":"transparent","index":3,"text":"üá´üá∑FR"},"GB":{"color":"transparent","index":7,"text":"üá¨üáßGB"},"IN":{"color":"transparent","index":5,"text":"üáÆüá≥IN"},"IT":{"color":"transparent","index":6,"text":"üáÆüáπIT"},"NL":{"color":"transparent","index":1,"text":"üá≥üá±NL"},"US":{"color":"transparent","index":0,"text":"üá∫üá∏ US"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"transparent","value":null}]}},"overrides":[]},"gridPos":{"h":11,"w":3,"x":21,"y":10},"hideTimeOverride":true,"id":32,"maxDataPoints":1,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"showHeader":false,"sortBy":[{"desc":true,"displayName":"Requests"}]},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"topk(10, sum by (geoip_country_code) (count_over_time({} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003cresponse_time\u003e \u003cgeoip_country_code\u003e` | geoip_country_code != \"-\" | geoip_country_code != \"\" and  __error__=\"\" [$__interval])))","instant":true,"legendFormat":"{{remote_addr}}","maxLines":0,"range":false,"refId":"A"}],"timeFrom":"15m","title":"Top Countries","transformations":[{"id":"sortBy","options":{"fields":{},"sort":[{"desc":true,"field":"Value #A"}]}},{"id":"organize","options":{"excludeByName":{"Field":false,"Time":true,"Value #A":true},"indexByName":{"Time":0,"Value #A":3,"geoip_country_code":2,"remote_addr":1},"renameByName":{"Field":"IP Address","Total":"Requests","Value #A":"Requests","geoip_country_code":"Country","remote_addr":"IP Address "}}}],"type":"table"},{"collapsed":false,"datasource":{"uid":"$datasource"},"gridPos":{"h":1,"w":24,"x":0,"y":21},"id":26,"panels":[],"targets":[{"datasource":{"uid":"$datasource"},"refId":"A"}],"title":"Request statistics over time","type":"row"},{"datasource":{"type":"loki","uid":"NX9d1VH7k"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":100,"gradientMode":"hue","hideFrom":{"graph":false,"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"log":2,"type":"log"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"#EAB839","value":0.2},{"color":"red","value":0.3}]},"unit":"s"},"overrides":[{"matcher":{"id":"byName","options":"95th percentile"},"properties":[{"id":"color","value":{"fixedColor":"blue","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"max latency"},"properties":[{"id":"color","value":{"fixedColor":"super-light-blue","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"max latency"},"properties":[{"id":"custom.fillOpacity","value":30}]}]},"gridPos":{"h":9,"w":8,"x":0,"y":22},"id":16,"maxDataPoints":50,"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"8.0.0-beta3","targets":[{"datasource":{"type":"loki","uid":"NX9d1VH7k"},"expr":"quantile_over_time(0.95,{} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003crequest_time\u003e \u003cgeoip_country_code\u003e` | unwrap request_time |  __error__=\"\"  [$__interval]) by (host)","legendFormat":"95th percentile","refId":"C"},{"datasource":{"type":"loki","uid":"NX9d1VH7k"},"expr":"max by (host) (max_over_time({}  | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003crequest_time\u003e \u003cgeoip_country_code\u003e` | unwrap request_time |  __error__=\"\"  [$__interval]))","legendFormat":"max latency","refId":"D"}],"title":"95th percentile of Request Time","type":"timeseries"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":39,"gradientMode":"hue","hideFrom":{"graph":false,"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"log":2,"type":"log"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"decimals":0,"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"short"},"overrides":[{"matcher":{"id":"byName","options":"HTTP Status 500"},"properties":[{"id":"color","value":{"fixedColor":"dark-orange","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"{statuscode=\"200\"} 200"},"properties":[{"id":"color","value":{"fixedColor":"green","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"{statuscode=\"404\"} 404"},"properties":[{"id":"color","value":{"fixedColor":"semi-dark-purple","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"{statuscode=\"500\"} 500"},"properties":[{"id":"color","value":{"fixedColor":"dark-red","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"HTTP Status 404"},"properties":[{"id":"color","value":{"fixedColor":"light-orange","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"HTTP Status 301"},"properties":[{"id":"color","value":{"fixedColor":"light-blue","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"HTTP Status 200"},"properties":[{"id":"color","value":{"fixedColor":"semi-dark-blue","mode":"fixed"}}]}]},"gridPos":{"h":9,"w":8,"x":8,"y":22},"id":2,"maxDataPoints":50,"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"8.0.0-beta3","targets":[{"datasource":{"uid":"$datasource"},"expr":"sum by (status) (count_over_time({} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003crequest_time\u003e` |  __error__=\"\" [$__interval]))","legendFormat":"HTTP Status {{status}}","refId":"A"}],"title":"HTTP status codes over time","transformations":[{"id":"filterFieldsByName","options":{"include":{"names":["Time","HTTP Status 200","HTTP Status 301","HTTP Status 304","HTTP Status 404","HTTP Status 406","HTTP Status 500"]}}}],"type":"timeseries"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":100,"gradientMode":"hue","hideFrom":{"graph":false,"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"decbytes"},"overrides":[{"matcher":{"id":"byName","options":"Bytes sent"},"properties":[{"id":"color","value":{"fixedColor":"light-blue","mode":"fixed"}}]},{"matcher":{"id":"byName","options":"appfelstrudel"},"properties":[{"id":"color","value":{"fixedColor":"yellow","mode":"fixed"}}]}]},"gridPos":{"h":9,"w":8,"x":16,"y":22},"id":9,"maxDataPoints":50,"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"8.0.0-beta3","targets":[{"datasource":{"uid":"$datasource"},"expr":"sum by (host) (sum_over_time({} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003crequest_time\u003e` | status=200 | unwrap body_bytes_sent |  __error__=\"\" [$__interval]))","legendFormat":"Bytes sent","refId":"A"}],"title":"Bytes Sent","transformations":[],"type":"timeseries"},{"collapsed":false,"datasource":{"uid":"$datasource"},"gridPos":{"h":1,"w":24,"x":0,"y":31},"id":28,"panels":[],"targets":[{"datasource":{"uid":"$datasource"},"refId":"A"}],"title":"Acquisition and Behaviour","type":"row"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","displayMode":"auto","filterable":false,"inspect":false},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"Requests"},"properties":[{"id":"custom.displayMode","value":"gradient-gauge"},{"id":"color","value":{"mode":"continuous-BlPu"}}]},{"matcher":{"id":"byName","options":"Requests"},"properties":[{"id":"custom.width","value":300}]}]},"gridPos":{"h":6,"w":10,"x":0,"y":32},"id":6,"maxDataPoints":1,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"showHeader":true,"sortBy":[{"desc":true,"displayName":"Requests"}]},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"topk(10, sum by (http_referer) (count_over_time({} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003chttp_referer\u003e\" \"\u003cuser_agent\u003e\" \u003cresponse_time\u003e \u003cgeoip_country_code\u003e` | http_referer != \"-\" and http_referer != \"\" and http_referer !~ \".*?$host.*?\" and http_referer !~ \".*?\\\\*\\\\*\\\\*.*?\" | __error__=\"\" [15m])))","instant":true,"legendFormat":"{{http_referer}}","range":false,"refId":"A"}],"timeFrom":"10h","title":"Top 10 HTTP Referers","transformations":[{"id":"organize","options":{"excludeByName":{"Time":true},"indexByName":{},"renameByName":{"Field":"Referer","Total":"Requests","Value #A":"Requests","http_referer":"HTTP Referrer"}}}],"type":"table"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","displayMode":"auto","filterable":false,"inspect":false},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"Requests"},"properties":[{"id":"custom.width","value":300},{"id":"custom.displayMode","value":"gradient-gauge"},{"id":"color","value":{"mode":"continuous-BlPu"}}]}]},"gridPos":{"h":6,"w":14,"x":10,"y":32},"id":7,"maxDataPoints":1,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"showHeader":true,"sortBy":[{"desc":true,"displayName":"Requests"}]},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"topk(10, sum by (user_agent) (count_over_time({} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003crequest_time\u003e` |  __error__=\"\" [15m])))","instant":true,"legendFormat":"{{http_user_agent}}","maxLines":0,"range":false,"refId":"A"}],"timeFrom":"10h","title":"Top 10 User Agents","transformations":[{"id":"organize","options":{"excludeByName":{"Field":false,"Time":true},"indexByName":{},"renameByName":{"Field":"Agent","Total":"Requests","Value #A":"Requests","http_user_agent":"User agent"}}}],"type":"table"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","displayMode":"auto","filterable":false,"inspect":false},"mappings":[{"options":{"NL":{"index":1,"text":"üá≥üá±"},"US":{"index":0,"text":"üá∫üá∏"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"Requests"},"properties":[{"id":"custom.width","value":300},{"id":"custom.displayMode","value":"gradient-gauge"},{"id":"color","value":{"mode":"continuous-BlPu"}}]},{"matcher":{"id":"byName","options":"Country"},"properties":[{"id":"custom.width","value":67}]}]},"gridPos":{"h":8,"w":10,"x":0,"y":38},"id":3,"maxDataPoints":1,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"showHeader":true,"sortBy":[{"desc":true,"displayName":"Requests"}]},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"topk(10, sum by (remote_addr, geoip_country_code) (count_over_time({} | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003cpath\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003cresponse_time\u003e \u003cgeoip_country_code\u003e` |  __error__=\"\" [15m])))","instant":true,"legendFormat":"{{remote_addr}}","range":false,"refId":"A"}],"timeFrom":"10h","title":"Top 10 visitor IPs","transformations":[{"id":"organize","options":{"excludeByName":{"Field":false,"Time":true},"indexByName":{"Time":0,"Value #A":3,"geoip_country_code":2,"remote_addr":1},"renameByName":{"Field":"IP Address","Total":"Requests","Value #A":"Requests","geoip_country_code":"Country","remote_addr":"IP Address "}}}],"type":"table"},{"datasource":{"uid":"$datasource"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","displayMode":"auto","filterable":false,"inspect":false},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"Requests"},"properties":[{"id":"custom.width","value":300},{"id":"custom.displayMode","value":"gradient-gauge"},{"id":"color","value":{"mode":"continuous-BlPu"}}]}]},"gridPos":{"h":8,"w":14,"x":10,"y":38},"id":12,"maxDataPoints":1,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"showHeader":true,"sortBy":[{"desc":true,"displayName":"Requests"}]},"pluginVersion":"9.2.5","targets":[{"datasource":{"uid":"$datasource"},"expr":"topk(10, sum by (request_uri) (count_over_time({} !~ `\\.ico|\\.svg|\\.css|\\.png|\\.txt|\\.js|\\.xml`  | pattern `\u003cremote_addr\u003e - - \u003cts\u003e \"\u003cmethod\u003e \u003crequest_uri\u003e \u003c_\u003e\" \u003cstatus\u003e \u003cbody_bytes_sent\u003e \"\u003c_\u003e\" \"\u003cuser_agent\u003e\" \u003cresponse_time\u003e` | status = 200 and request_uri != \"/\" | __error__=\"\" [15m])))","instant":true,"legendFormat":"{{request_uri}}","range":false,"refId":"A"}],"timeFrom":"10h","title":"Top 10 Requested Pages","transformations":[{"id":"organize","options":{"excludeByName":{"Time":true},"indexByName":{},"renameByName":{"Field":"Page","Time":"","Total":"","Value #A":"Requests","request_uri":"Path"}}}],"type":"table"}],"refresh":false,"schemaVersion":37,"style":"dark","tags":["ds-example"],"templating":{"list":[{"datasource":{"type":"loki","uid":"NX9d1VH7k"},"filters":[{"condition":"","key":"filename","operator":"=","value":"/var/log/nginx/access.log"}],"hide":0,"name":"adhoc","skipUrlSync":false,"type":"adhoc"},{"current":{"selected":true,"text":"Loki","value":"Loki"},"hide":0,"includeAll":false,"multi":false,"name":"datasource","options":[],"query":"loki","queryValue":"","refresh":1,"regex":"","skipUrlSync":false,"type":"datasource"}]},"time":{"from":"now-24h","to":"now"},"timepicker":{"refresh_intervals":["10s","30s","1m","5m","15m","30m","1h","2h","1d"]},"timezone":"","title":"Loki NGINX Service Mesh - Pattern version","uid":"-lPcmrp7z","version":38,"weekStart":""}}