{"meta":{"type":"db","canSave":false,"canEdit":true,"canAdmin":false,"canStar":false,"canDelete":false,"slug":"empty-variables-demo-postgres","url":"/d/63QPo8M7k/empty-variables-demo-postgres","expires":"0001-01-01T00:00:00Z","created":"2021-08-09T15:10:41Z","updated":"2021-08-09T15:34:57Z","updatedBy":"pkolyvas","createdBy":"pkolyvas","version":2,"hasAcl":false,"isFolder":false,"folderId":1166,"folderUid":"-Ybx2UMnk","folderTitle":"Product","folderUrl":"/dashboards/f/-Ybx2UMnk/product","provisioned":false,"provisionedExternalId":"","annotationsPermissions":{"dashboard":{"canAdd":true,"canEdit":true,"canDelete":true},"organization":{"canAdd":false,"canEdit":false,"canDelete":false}},"hasPublicDashboard":false,"publicDashboardAccessToken":"","publicDashboardUid":"","publicDashboardEnabled":false},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"description":"Dashboard which shows current outages from Nodes, Interfaces and Services in selected Surveillance Categories.","editable":true,"gnetId":5921,"graphTooltip":0,"id":1170,"iteration":1628523275355,"links":[],"panels":[{"collapsed":false,"datasource":null,"fieldConfig":{"defaults":{},"overrides":[]},"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":15,"panels":[],"repeat":null,"title":"Outstanding Business Service Alarms","type":"row"},{"columns":[],"datasource":"PostgreSQL","fontSize":"100%","gridPos":{"h":5,"w":24,"x":0,"y":1},"id":16,"links":[],"pageSize":null,"scroll":true,"showHeader":true,"sort":{"col":null,"desc":false},"styles":[{"alias":"Time","align":"auto","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"Last Event Time","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"lasteventtime","thresholds":[],"type":"date","unit":"short"},{"alias":"Affected since first event time","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration","thresholds":[],"type":"string","unit":"short"},{"alias":"First Event Time","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"firsteventtime","thresholds":[],"type":"date","unit":"short"},{"alias":"Business Service Name","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"name","thresholds":[],"type":"string","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"alias":"","format":"table","group":[],"metricColumn":"none","rawQuery":true,"rawSql":"SELECT\n  bsm_service.name,\n  bsmAlarm.firsteventtime,\n  bsmAlarm.lasteventtime,\n  EXTRACT(DAYS FROM age(now(), bsmAlarm.firsteventtime)) || 'd ' || EXTRACT(HOURS FROM age(now(), bsmAlarm.firsteventtime)) || 'h ' || EXTRACT(MINUTES FROM age(now(), bsmAlarm.firsteventtime)) || 'm ' || ROUND(EXTRACT(SECONDS FROM age(now(), bsmAlarm.lasteventtime))::NUMERIC,0) || 's' AS duration\nFROM\n  bsm_service\nJOIN\n  (SELECT\n    substring(reductionkey from '[0-9]+$')::INTEGER AS bsmId,\n    alarms.firsteventtime,\n    alarms.lasteventtime\n  FROM\n    alarms\n  WHERE\n    eventuei = 'uei.opennms.org/bsm/serviceProblem') AS bsmAlarm\nON\n   bsmAlarm.bsmId = bsm_service.id\nORDER BY\n  bsmAlarm.lasteventtime DESC,\n  duration DESC,\n  bsm_service.name ASC","refId":"A","select":[[{"params":["value"],"type":"column"}]],"timeColumn":"time","where":[{"name":"$__timeFilter","params":[],"type":"macro"}]}],"title":"Node Alarms in Category: $category","transform":"table","type":"table-old"},{"collapsed":false,"datasource":null,"fieldConfig":{"defaults":{},"overrides":[]},"gridPos":{"h":1,"w":24,"x":0,"y":6},"id":13,"panels":[],"repeat":null,"title":"Outstanding Alarms","type":"row"},{"columns":[],"datasource":"PostgreSQL","fontSize":"100%","gridPos":{"h":6,"w":7,"x":0,"y":7},"id":9,"links":[],"pageSize":null,"scroll":true,"showHeader":true,"sort":{"col":0,"desc":true},"styles":[{"alias":"Time","align":"auto","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"Location","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"location","thresholds":[],"type":"string","unit":"short"},{"alias":"Node Label","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"nodelabel","thresholds":[],"type":"string","unit":"short"},{"alias":"Last Event Time","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"lasteventtime","thresholds":[],"type":"date","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration_raw","thresholds":[],"type":"hidden","unit":"short"},{"alias":"Affected since","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration","thresholds":[],"type":"string","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"alias":"","format":"table","group":[],"metricColumn":"none","rawQuery":true,"rawSql":"SELECT\n  node_alarms.location,\n  node_alarms.nodelabel,\n  node_alarms.lasteventtime,\n  to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime AS duration_raw,\n  EXTRACT(DAYS FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime) || 'd ' || EXTRACT(HOURS FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime) || 'h ' || EXTRACT(MINUTES FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime) || 'm ' || ROUND(EXTRACT(SECONDS FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime)::NUMERIC,0) || 's' AS duration\nFROM\n  node_alarms\nWHERE\n  node_alarms.acknowledged = FALSE AND\n  node_alarms.eventuei like 'uei.opennms.org/nodes/nodeDown' AND\n  node_alarms.location IN ($location) AND\n  node_alarms.categoryname IN ($category) AND\n  node_alarms.max_alarm_severity_unack = '6'\nGROUP BY\n  node_alarms.location,\n  node_alarms.nodelabel,\n  node_alarms.nodeid,\n  node_alarms.firsteventtime,\n  node_alarms.lasteventtime\nORDER BY\n  duration_raw DESC,\n  node_alarms.location ASC,\n  node_alarms.nodelabel ASC","refId":"A","select":[[{"params":["value"],"type":"column"}]],"timeColumn":"time","where":[{"name":"$__timeFilter","params":[],"type":"macro"}]}],"title":"Node Alarms in Category: $category","transform":"table","type":"table-old"},{"columns":[],"datasource":"PostgreSQL","fontSize":"100%","gridPos":{"h":6,"w":7,"x":7,"y":7},"id":10,"links":[],"pageSize":null,"scroll":true,"showHeader":true,"sort":{"col":0,"desc":true},"styles":[{"alias":"Time","align":"auto","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"Location","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"location","thresholds":[],"type":"string","unit":"short"},{"alias":"Node Label","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"nodelabel","thresholds":[],"type":"string","unit":"short"},{"alias":"First Event Time","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"firsteventtime","thresholds":[],"type":"date","unit":"short"},{"alias":"Last Event Time","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"lasteventtime","thresholds":[],"type":"date","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration_raw","thresholds":[],"type":"hidden","unit":"short"},{"alias":"Affected since","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration","thresholds":[],"type":"string","unit":"short"},{"alias":"IP Address","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"ipaddr","thresholds":[],"type":"string","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"alias":"","format":"table","group":[],"metricColumn":"none","rawQuery":true,"rawSql":"SELECT\n  node_alarms.location,\n  node_alarms.nodelabel,\n  node_alarms.ipaddr,\n  node_alarms.lasteventtime,\n  to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime AS duration_raw,\n  EXTRACT(DAYS FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime) || 'd ' || EXTRACT(HOURS FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime) || 'h ' || EXTRACT(MINUTES FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime) || 'm ' || ROUND(EXTRACT(SECONDS FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime)::NUMERIC,0) || 's' AS duration\nFROM\n  node_alarms\nWHERE\n  node_alarms.acknowledged = FALSE AND\n  node_alarms.eventuei like 'uei.opennms.org/nodes/interfaceDown' AND\n  node_alarms.location IN ($location) AND\n  node_alarms.categoryname IN ($category) AND\n  node_alarms.max_alarm_severity_unack = '5'\nGROUP BY\n  node_alarms.location,\n  node_alarms.nodeid,\n  node_alarms.nodelabel,\n  node_alarms.ipaddr,\n  node_alarms.firsteventtime,\n  node_alarms.lasteventtime\nORDER BY\n  duration_raw DESC,\n  node_alarms.location ASC,\n  node_alarms.nodelabel ASC,\n  node_alarms.ipaddr ASC","refId":"A","select":[[{"params":["value"],"type":"column"}]],"timeColumn":"time","where":[{"name":"$__timeFilter","params":[],"type":"macro"}]}],"title":"Interface Alarms in Category: $category","transform":"table","type":"table-old"},{"columns":[],"datasource":"PostgreSQL","fontSize":"100%","gridPos":{"h":6,"w":10,"x":14,"y":7},"id":11,"links":[],"pageSize":null,"scroll":true,"showHeader":true,"sort":{"col":0,"desc":true},"styles":[{"alias":"Time","align":"auto","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"Location","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"location","thresholds":[],"type":"string","unit":"short"},{"alias":"Node Label","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"nodelabel","thresholds":[],"type":"string","unit":"short"},{"alias":"Last Event","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"lasteventtime","thresholds":[],"type":"date","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration_raw","thresholds":[],"type":"hidden","unit":"short"},{"alias":"Affected since","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration","thresholds":[],"type":"string","unit":"short"},{"alias":"IP Address","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"ipaddr","thresholds":[],"type":"string","unit":"short"},{"alias":"Service Name","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"servicename","thresholds":[],"type":"string","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"alias":"","format":"table","group":[],"metricColumn":"none","rawQuery":true,"rawSql":"SELECT\n  node_alarms.location,\n  node_alarms.nodelabel,\n  node_alarms.ipaddr,\n  node_alarms.servicename,\n  node_alarms.lasteventtime,\n  to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime AS duration_raw,\n  EXTRACT(DAYS FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime) || 'd ' || EXTRACT(HOURS FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime) || 'h ' || EXTRACT(MINUTES FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime) || 'm ' || ROUND(EXTRACT(SECONDS FROM to_timestamp($__unixEpochTo()) - node_alarms.firsteventtime)::NUMERIC,0) || 's' AS duration\nFROM\n  node_alarms\nWHERE\n  node_alarms.acknowledged = FALSE AND\n  node_alarms.eventuei like 'uei.opennms.org/nodes/nodeLostService' AND\n  node_alarms.location IN ($location) AND\n  node_alarms.categoryname IN ($category) AND\n  node_alarms.max_alarm_severity_unack = '5'\nGROUP BY\n  node_alarms.location,\n  node_alarms.nodeid,\n  node_alarms.nodelabel,\n  node_alarms.ipaddr,\n  node_alarms.servicename,\n  node_alarms.firsteventtime,\n  node_alarms.lasteventtime\nORDER BY\n  duration_raw DESC,\n  node_alarms.location ASC,\n  node_alarms.nodelabel ASC,\n  node_alarms.ipaddr ASC,\n  node_alarms.servicename ASC","refId":"A","select":[[{"params":["value"],"type":"column"}]],"timeColumn":"time","where":[{"name":"$__timeFilter","params":[],"type":"macro"}]}],"title":"Service Alarms in Category: $category","transform":"table","type":"table-old"},{"collapsed":false,"datasource":null,"fieldConfig":{"defaults":{},"overrides":[]},"gridPos":{"h":1,"w":24,"x":0,"y":13},"id":2,"panels":[],"repeat":null,"title":"Current Outages","type":"row"},{"columns":[],"datasource":"PostgreSQL","description":"Availability for Nodes with outages in a selected Surveillance Category","fontSize":"100%","gridPos":{"h":6,"w":7,"x":0,"y":14},"id":5,"links":[],"pageSize":10,"scroll":false,"showHeader":true,"sort":{"col":4,"desc":false},"styles":[{"alias":"Time","align":"auto","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"Node Label","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"nodelabel","thresholds":[],"type":"string","unit":"short"},{"alias":"Outage since","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration","thresholds":[],"type":"string","unit":"short"},{"alias":"Availability in %","align":"auto","colorMode":"value","colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":3,"pattern":"availability","thresholds":["70","90"],"type":"number","unit":"percent"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration_raw","thresholds":[],"type":"hidden","unit":"short"},{"alias":"Location","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"location","thresholds":[],"type":"string","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"alias":"","format":"table","group":[],"metricColumn":"none","rawQuery":true,"rawSql":"SELECT\n  n.location,\n  n.nodelabel,\n  100.0 - 100.0/(EXTRACT(EPOCH FROM to_timestamp($__unixEpochTo())) - EXTRACT(EPOCH FROM to_timestamp($__unixEpochFrom()))) * EXTRACT(EPOCH FROM (to_timestamp($__unixEpochTo()) - GREATEST(n.iflostservice, to_timestamp($__unixEpochFrom())))) AS availability,\n  to_timestamp($__unixEpochTo()) - n.iflostservice AS duration_raw,\n  EXTRACT(DAYS FROM to_timestamp($__unixEpochTo()) - n.iflostservice) || 'd ' || EXTRACT(HOURS FROM to_timestamp($__unixEpochTo()) - n.iflostservice) || 'h ' || EXTRACT(MINUTES FROM to_timestamp($__unixEpochTo()) - n.iflostservice) || 'm ' || ROUND(EXTRACT(SECONDS FROM to_timestamp($__unixEpochTo()) - n.iflostservice)::NUMERIC,0) || 's' AS duration\nFROM\n  node_outages n\nJOIN\n  node_outage_status nos\nON\n  n.nodeid = nos.nodeid\nWHERE\n  n.resolved = FALSE AND\n  n.svclosteventuei = 'uei.opennms.org/nodes/nodeDown' AND\n  nos.max_outage_severity = '6' AND\n  n.categoryname IN ($category) AND\n  n.location IN ($location)\nGROUP BY\n  n.location,\n  n.nodelabel,\n  n.eventseverity,\n  n.iflostservice\nORDER BY\n  duration_raw DESC,\n  availability ASC,\n  n.location ASC,\n  n.nodelabel ASC","refId":"A","select":[[{"params":["value"],"type":"column"}]],"timeColumn":"time","where":[{"name":"$__timeFilter","params":[],"type":"macro"}]}],"title":"Nodes in Category: $category","transform":"table","type":"table-old"},{"columns":[],"datasource":"PostgreSQL","description":"Availability for Interfaces with outages in a selected Surveillance Category","fontSize":"100%","gridPos":{"h":6,"w":7,"x":7,"y":14},"id":6,"links":[],"pageSize":10,"scroll":false,"showHeader":true,"sort":{"col":4,"desc":true},"styles":[{"alias":"Time","align":"auto","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"Node Label","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"nodelabel","thresholds":[],"type":"string","unit":"short"},{"alias":"Outage since","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration","thresholds":[],"type":"string","unit":"short"},{"alias":"Availability in %","align":"auto","colorMode":"value","colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":3,"pattern":"availability","thresholds":["70","90"],"type":"number","unit":"percent"},{"alias":"IP Address","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"ipaddr","thresholds":[],"type":"number","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration_raw","thresholds":[],"type":"hidden","unit":"short"},{"alias":"Location","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"location","thresholds":[],"type":"string","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"alias":"","format":"table","group":[],"metricColumn":"none","rawQuery":true,"rawSql":"SELECT\n  n.location,\n  n.nodelabel,\n  n.ipaddr,\n  100.0 - 100.0/(EXTRACT(EPOCH FROM to_timestamp($__unixEpochTo())) - EXTRACT(EPOCH FROM to_timestamp($__unixEpochFrom()))) * EXTRACT(EPOCH FROM (to_timestamp($__unixEpochTo()) - GREATEST(n.iflostservice, to_timestamp($__unixEpochFrom())))) AS availability,\n  to_timestamp($__unixEpochTo()) - n.iflostservice AS duration_raw,\n  EXTRACT(DAYS FROM to_timestamp($__unixEpochTo()) - n.iflostservice) || 'd ' || EXTRACT(HOURS FROM to_timestamp($__unixEpochTo()) - n.iflostservice) || 'h ' || EXTRACT(MINUTES FROM to_timestamp($__unixEpochTo()) - n.iflostservice) || 'm ' || ROUND(EXTRACT(SECONDS FROM to_timestamp($__unixEpochTo()) - n.iflostservice)::NUMERIC,0) || 's' AS duration\nFROM\n  node_outages n\nJOIN\n  node_outage_status nos\nON\n  n.nodeid = nos.nodeid\nWHERE\n  n.resolved = FALSE AND\n  n.svclosteventuei = 'uei.opennms.org/nodes/interfaceDown' AND\n  nos.max_outage_severity = '5' AND\n  n.categoryname IN ($category) AND\n  n.location IN ($location)\nGROUP BY\n  n.location,\n  n.nodelabel,\n  n.iflostservice,\n  n.ipaddr,\n  n.eventseverity,\n  n.svclosteventuei\nORDER BY\n  duration_raw DESC,\n  availability ASC,\n  n.location ASC,\n  n.nodelabel ASC,\n  n.ipaddr ASC\n","refId":"A","select":[[{"params":["value"],"type":"column"}]],"timeColumn":"time","where":[{"name":"$__timeFilter","params":[],"type":"macro"}]}],"title":"Node Interfaces in Category: $category","transform":"table","type":"table-old"},{"columns":[],"datasource":"PostgreSQL","description":"Availability for Services with outages in a selected Surveillance Category","fontSize":"100%","gridPos":{"h":6,"w":10,"x":14,"y":14},"id":7,"links":[],"pageSize":10,"scroll":false,"showHeader":true,"sort":{"col":4,"desc":true},"styles":[{"alias":"Time","align":"auto","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"date"},{"alias":"Node Label","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"nodelabel","thresholds":[],"type":"string","unit":"short"},{"alias":"Outage since","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration","thresholds":[],"type":"string","unit":"short"},{"alias":"Availability in %","align":"auto","colorMode":"value","colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":3,"pattern":"availability","thresholds":["70","90"],"type":"number","unit":"percent"},{"alias":"IP Address","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"ipaddr","thresholds":[],"type":"number","unit":"short"},{"alias":"Service Name","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"servicename","thresholds":[],"type":"number","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"duration_raw","thresholds":[],"type":"hidden","unit":"short"},{"alias":"Location","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"pattern":"location","thresholds":[],"type":"string","unit":"short"},{"alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"/.*/","thresholds":[],"type":"number","unit":"short"}],"targets":[{"alias":"","format":"table","group":[],"metricColumn":"none","rawQuery":true,"rawSql":"SELECT\n  n.location,\n  n.nodelabel,\n  n.ipaddr,\n  n.servicename,\n  100.0 - 100.0/(EXTRACT(EPOCH FROM to_timestamp($__unixEpochTo())) - EXTRACT(EPOCH FROM to_timestamp($__unixEpochFrom()))) * EXTRACT(EPOCH FROM (to_timestamp($__unixEpochTo()) - GREATEST(n.iflostservice, to_timestamp($__unixEpochFrom())))) AS availability,\n  to_timestamp($__unixEpochTo()) - n.iflostservice AS duration_raw,\n  EXTRACT(DAYS FROM to_timestamp($__unixEpochTo()) - n.iflostservice) || 'd ' || EXTRACT(HOURS FROM to_timestamp($__unixEpochTo()) - n.iflostservice) || 'h ' || EXTRACT(MINUTES FROM to_timestamp($__unixEpochTo()) - n.iflostservice) || 'm ' || ROUND(EXTRACT(SECONDS FROM to_timestamp($__unixEpochTo()) - n.iflostservice)::NUMERIC,0) || 's' AS duration\nFROM\n  node_outages n\nJOIN\n  node_outage_status nos\nON\n  n.nodeid = nos.nodeid\nWHERE\n  n.resolved = FALSE AND\n  n.svclosteventuei = 'uei.opennms.org/nodes/nodeLostService' AND\n  nos.max_outage_severity = '5' AND\n  n.categoryname IN ($category) AND\n  n.location IN ($location)\nGROUP BY\n  n.location,\n  n.nodelabel,\n  n.iflostservice,\n  n.ipaddr,\n  n.eventseverity,\n  n.servicename\nORDER BY\n  duration_raw DESC,\n  availability ASC,\n  n.location ASC,\n  n.nodelabel ASC,\n  n.ipaddr ASC,\n  n.servicename ASC","refId":"A","select":[[{"params":["value"],"type":"column"}]],"timeColumn":"time","where":[{"name":"$__timeFilter","params":[],"type":"macro"}]}],"title":"Node Services in Category: $category","transform":"table","type":"table-old"}],"refresh":"10s","schemaVersion":30,"style":"dark","tags":["opennms"],"templating":{"list":[{"allValue":null,"current":{},"datasource":"PostgreSQL","definition":"","description":null,"error":{"config":{"data":{"from":"1628436895253","queries":[{"datasourceId":159,"format":"table","rawSql":"SELECT DISTINCT(n.location) FROM node n ORDER BY location ASC","refId":"location"}],"to":"1628523295253"},"headers":{"X-Grafana-Org-Id":1},"hideFromInspector":false,"method":"POST","requestId":"location","retry":0,"url":"api/ds/query"},"data":{"results":{"location":{"error":"db query error: failed to connect to server - please inspect Grafana server log for details","frames":[{"data":{"values":[]},"schema":{"fields":[],"meta":{"executedQueryString":"SELECT DISTINCT(n.location) FROM node n ORDER BY location ASC"}}}]}}},"message":"Query error: 400 ","status":400,"statusText":""},"hide":0,"includeAll":true,"label":"Monitoring Location","multi":true,"name":"location","options":[],"query":"SELECT DISTINCT(n.location) FROM node n ORDER BY location ASC","refresh":2,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{},"datasource":"PostgreSQL","definition":"","description":null,"error":{"config":{"data":{"from":"1628436875256","queries":[{"datasourceId":159,"format":"table","rawSql":"SELECT 'no category'::TEXT as categoryname UNION SELECT categoryname FROM categories ORDER BY categoryname","refId":"category"}],"to":"1628523275256"},"headers":{"X-Grafana-Org-Id":1},"hideFromInspector":false,"method":"POST","requestId":"category","retry":0,"url":"api/ds/query"},"data":{"results":{"category":{"error":"db query error: failed to connect to server - please inspect Grafana server log for details","frames":[{"data":{"values":[]},"schema":{"fields":[],"meta":{"executedQueryString":"SELECT 'no category'::TEXT as categoryname UNION SELECT categoryname FROM categories ORDER BY categoryname"}}}]}}},"message":"Query error: 400 ","status":400,"statusText":""},"hide":0,"includeAll":true,"label":"Surveillance Category","multi":true,"name":"category","options":[],"query":"SELECT 'no category'::TEXT as categoryname UNION SELECT categoryname FROM categories ORDER BY categoryname","refresh":1,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-24h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Empty Variables Demo - Postgres","uid":"63QPo8M7k","version":2}}